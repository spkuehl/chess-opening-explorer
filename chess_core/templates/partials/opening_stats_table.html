{% if stats %}
<style>
  .results-bar { display: flex; width: 100%; height: 1.75rem; min-width: 160px; border-radius: 4px; overflow: hidden; }
  .results-bar span { display: flex; align-items: center; justify-content: center; min-width: 0; font-size: 0.7rem; font-weight: 600; white-space: nowrap; overflow: hidden; }
  .results-bar .w { background: #e5e7eb; color: #1f2937; flex: 0 0 auto; }
  .results-bar .d { background: #9ca3af; color: #111827; flex: 0 0 auto; }
  .results-bar .b { background: #374151; color: #f9fafb; flex: 1 0 0; }
</style>
<p>Total: {{ total }} opening{{ total|pluralize }}.</p>
<table>
  <thead>
    <tr>
      <th><a href="{% url 'explore' %}{{ column_links.eco_code.url }}" hx-get="{% url 'explore' %}{{ column_links.eco_code.url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">{{ column_links.eco_code.indicator }} ECO</a></th>
      <th><a href="{% url 'explore' %}{{ column_links.name.url }}" hx-get="{% url 'explore' %}{{ column_links.name.url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">{{ column_links.name.indicator }} Opening</a></th>
      <th><a href="{% url 'explore' %}{{ column_links.game_count.url }}" hx-get="{% url 'explore' %}{{ column_links.game_count.url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">{{ column_links.game_count.indicator }} Games</a></th>
      <th><a href="{% url 'explore' %}{{ column_links.results.url }}" hx-get="{% url 'explore' %}{{ column_links.results.url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">{{ column_links.results.indicator }} {{ column_links.results.label }}</a></th>
      <th><a href="{% url 'explore' %}{{ column_links.avg_moves.url }}" hx-get="{% url 'explore' %}{{ column_links.avg_moves.url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">{{ column_links.avg_moves.indicator }} Avg moves</a></th>
    </tr>
  </thead>
  <tbody>
    {% for row in stats %}
    <tr>
      <td>{{ row.eco_code }}</td>
      <td>{{ row.name }}<br><span style="font-size: 0.875em">{{ row.moves }}</span></td>
      <td>{{ row.game_count }}</td>
      <td>
        {% if row.game_count %}
        <div class="results-bar" title="White {{ row.white_wins }} · Draw {{ row.draws }} · Black {{ row.black_wins }}">
          <span class="w" style="width: {{ row.white_pct|default:0 }}%">{% if row.white_pct %}{{ row.white_pct }}%{% endif %}</span>
          <span class="d" style="width: {{ row.draw_pct|default:0 }}%"></span>
          <span class="b" style="flex: 1 0 0">{% if row.black_pct %}{{ row.black_pct }}%{% endif %}</span>
        </div>
        {% else %}
        <div class="results-bar" title="No games"><span class="d" style="width: 100%"></span></div>
        {% endif %}
      </td>
      <td>{{ row.avg_moves|default:"—" }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if pagination.total_pages > 1 %}
<nav aria-label="Pagination">
  <p>Page {{ pagination.page }} of {{ pagination.total_pages }}.</p>
  {% if pagination.prev_url %}
  <a href="{% url 'explore' %}{{ pagination.prev_url }}" hx-get="{% url 'explore' %}{{ pagination.prev_url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">Previous</a>
  {% endif %}
  {% if pagination.next_url %}
  <a href="{% url 'explore' %}{{ pagination.next_url }}" hx-get="{% url 'explore' %}{{ pagination.next_url }}" hx-target="#opening-stats-results" hx-swap="innerHTML" hx-push-url="true">Next</a>
  {% endif %}
</nav>
{% endif %}
{% else %}
<p>No openings match the filters.</p>
{% endif %}
